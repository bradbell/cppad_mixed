<html>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath:  [ ['@(@','@)@'] ] ,
    displayMath: [ ['@[@','@]@'] ]
  }
});
</script>
<script type='text/javascript' src=
'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default'
>
</script>
<head>
<title>Sample Posterior for Fixed Effects</title>
<meta http-equiv='Content-Type' content='text/html' charset='utf-8'>
<meta name="description" id="description" content="Sample Posterior for Fixed Effects">
<meta name="keywords" id="keywords" content=" sample posterior fixed effects syntax see also prototype public purpose manage_gsl_rng mixed_object information_rcv solution fixed_lower fixed_upper random_opt positive definite theory notation unconstrained subset covariance approximate constraint equations implicit information example other method 2do ">
<style type='text/css'>
body { color : black }
body { background-color : white }
A:link { color : blue }
A:visited { color : purple }
A:active { color : purple }
</style>
<script type='text/javascript' language='JavaScript' src='_sample_fixed_htm.js'>
</script>
</head>
<body>
<table><tr>
<td><a href="information_mat.cpp.htm" target="_top">Prev</a>
</td><td><a href="sample_fixed.cpp.htm" target="_top">Next</a>
</td><td>
<select onchange='choose_across0(this)'>
<option>Index-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Up-&gt;</option>
<option>cppad_mixed</option>
<option>base_class</option>
<option>public</option>
<option>sample_fixed</option>
</select>
</td>
<td>
<select onchange='choose_down3(this)'>
<option>cppad_mixed-&gt;</option>
<option>install_unix</option>
<option>theory</option>
<option>base_class</option>
<option>namespace</option>
<option>user</option>
<option>whats_new_17</option>
<option>wish_list</option>
<option>math_notation</option>
</select>
</td>
<td>
<select onchange='choose_down2(this)'>
<option>base_class-&gt;</option>
<option>public</option>
<option>private</option>
</select>
</td>
<td>
<select onchange='choose_down1(this)'>
<option>public-&gt;</option>
<option>derived_ctor</option>
<option>ran_likelihood</option>
<option>fix_likelihood</option>
<option>fix_constraint</option>
<option>initialize</option>
<option>optimize_random</option>
<option>optimize_fixed</option>
<option>information_mat</option>
<option>sample_fixed</option>
<option>sample_random</option>
<option>ran_likelihood_jac</option>
<option>ran_likelihood_hes</option>
</select>
</td>
<td>
<select onchange='choose_down0(this)'>
<option>sample_fixed-&gt;</option>
<option>sample_fixed.cpp</option>
<option>sample_conditional</option>
</select>
</td>
<td>
<select onchange='choose_current0(this)'>
<option>Headings-&gt;</option>
<option>Syntax</option>
<option>See Also</option>
<option>Prototype</option>
<option>Public</option>
<option>Purpose</option>
<option>manage_gsl_rng</option>
<option>mixed_object</option>
<option>sample</option>
<option>information_rcv</option>
<option>solution</option>
<option>fixed_lower</option>
<option>fixed_upper</option>
<option>random_opt</option>
<option>Positive Definite</option>
<option>Theory</option>
<option>---..Notation</option>
<option>---..Unconstrained Subset Covariance</option>
<option>---..Approximate Constraint Equations</option>
<option>---..Implicit Information</option>
<option>---..Implicit Covariance</option>
<option>Example</option>
<option>Other Method</option>
<option>2DO</option>
</select>
</td>
</tr></table><br>
@(@\newcommand{\R}[1]{ {\rm #1} }
\newcommand{\B}[1]{ {\bf #1} }
\newcommand{\W}[1]{ \; #1 \; }@)@<center><b><big><big>Sample Posterior for Fixed Effects</big></big></b></center>
<br>
<b><big><a name="Syntax" id="Syntax">Syntax</a></big></b>

<br>

<code><i><font color="black"><span style='white-space: nowrap'>mixed_object</span></font></i><font color="blue"><span style='white-space: nowrap'>.sample_fixed(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>sample</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>information_rcv</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>fixed_lower</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>fixed_upper</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_opt</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
)</span></font></code>


<br>
<br>
<b><big><a name="See Also" id="See Also">See Also</a></big></b>

<br>
<a href="sample_random.htm" target="_top"><span style='white-space: nowrap'>sample_random</span></a>
, <a href="sample_conditional.htm" target="_top"><span style='white-space: nowrap'>sample_conditional</span></a>


<br>
<br>
<b><big><a name="Prototype" id="Prototype">Prototype</a></big></b>

<pre><tt>
<font color="#009900">void</font> cppad_mixed<font color="#990000">::</font><b><font color="#000000">sample_fixed</font></b><font color="#990000">(</font>
     CppAD<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;</font>                 sample               <font color="#990000">,</font>
     <b><font color="#0000FF">const</font></b> sparse_rcv<font color="#990000">&amp;</font>                      information_rcv      <font color="#990000">,</font>
     <b><font color="#0000FF">const</font></b> CppAD<font color="#990000">::</font>mixed<font color="#990000">::</font>fixed_solution<font color="#990000">&amp;</font>    solution             <font color="#990000">,</font>
     <b><font color="#0000FF">const</font></b> CppAD<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;</font>           fixed_lower          <font color="#990000">,</font>
     <b><font color="#0000FF">const</font></b> CppAD<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;</font>           fixed_upper          <font color="#990000">,</font>
     <b><font color="#0000FF">const</font></b> CppAD<font color="#990000">::</font>vector<font color="#990000">&lt;</font><font color="#009900">double</font><font color="#990000">&gt;&amp;</font>           random_opt           <font color="#990000">)</font></tt></pre>
<br>
<b><big><a name="Public" id="Public">Public</a></big></b>
<br>
This <code><font color="blue">cppad_mixed</font></code> member function is <a href="public.htm" target="_top"><span style='white-space: nowrap'>public</span></a>
.

<br>
<br>
<b><big><a name="Purpose" id="Purpose">Purpose</a></big></b>
<br>
This routine draws samples from
the asymptotic posterior distribution for the
fixed effects (given the model and the data).

<br>
<br>
<b><big><a name="manage_gsl_rng" id="manage_gsl_rng">manage_gsl_rng</a></big></b>
<br>
It is assumed that
<a href="manage_gsl_rng.htm#get_gsl_rng" target="_top"><span style='white-space: nowrap'>get_gsl_rng</span></a>
 will return
a pointer to a GSL random number generator.

<br>
<br>
<b><big><a name="mixed_object" id="mixed_object">mixed_object</a></big></b>
<br>
We use <a href="derived_ctor.htm#mixed_object" target="_top"><span style='white-space: nowrap'>mixed_object</span></a>

to denote an object of a class that is
derived from the <code><font color="blue">cppad_mixed</font></code> base class.

<br>
<br>
<b><big><a name="sample" id="sample">sample</a></big></b>
<br>
The size 
<code><i><font color="black"><span style='white-space: nowrap'>sample</span></font></i><font color="blue"><span style='white-space: nowrap'>.size()</span></font></code>
 is a multiple of
<a href="derived_ctor.htm#n_fixed" target="_top"><span style='white-space: nowrap'>n_fixed</span></a>
.
The input value of its elements does not matter.
We define

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>n_sample</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>sample_size</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;/&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>n_fixed</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>
Upon return,
for 
<code><font color="blue"><span style='white-space: nowrap'>i</span></font><i><font color="black"><span style='white-space: nowrap'>&nbsp;=&nbsp;0&nbsp;,&nbsp;</span></font></i><font color="blue"><span style='white-space: nowrap'>...</span></font><i><font color="black"><span style='white-space: nowrap'>,&nbsp;</span></font></i><font color="blue"><span style='white-space: nowrap'>n_sample</span></font><i><font color="black"><span style='white-space: nowrap'>-1</span></font></i></code>
,

<code><font color="blue"><span style='white-space: nowrap'>j</span></font><i><font color="black"><span style='white-space: nowrap'>&nbsp;=&nbsp;0&nbsp;,&nbsp;</span></font></i><font color="blue"><span style='white-space: nowrap'>...</span></font><i><font color="black"><span style='white-space: nowrap'>,&nbsp;</span></font></i><font color="blue"><span style='white-space: nowrap'>n_fixed</span></font><i><font color="black"><span style='white-space: nowrap'>-1</span></font></i></code>
,

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>sample</span></font></i><font color="blue"><span style='white-space: nowrap'>[&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>i</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;*&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>n_fixed</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;+&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>j</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;]<br>
</span></font></code>
is the <code><i>j</i></code>-th component of the <code><i>i</i></code>-th sample of the
optimal fixed effects <small>@(@
\hat{\theta}
@)@</small>.
These samples are independent for different <small>@(@
i
@)@</small>,
and for fixed <small>@(@
i
@)@</small>, they have the
<a href="sample_fixed.htm#Theory.Implicit Covariance" target="_top"><span style='white-space: nowrap'>implicit&nbsp;covariance</span></a>
.

<br>
<br>
<b><big><a name="information_rcv" id="information_rcv">information_rcv</a></big></b>
<br>
This is a sparse matrix representation for the
lower triangle of the observed information matrix corresponding to

<code><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i></code>
; i.e., the matrix returned by

<code><font color="blue"><span style='white-space: nowrap'><br>
</span></font><i><font color="black"><span style='white-space: nowrap'>information_rcv</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>mixed_object</span></font></i><font color="blue"><span style='white-space: nowrap'>.information_mat(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_options</span></font></i><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_lower</span></font></i><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_upper</span></font></i><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_in</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
)</span></font></code>


<br>
<br>
<b><big><a name="solution" id="solution">solution</a></big></b>
<br>
is the <a href="optimize_fixed.htm#solution" target="_top"><span style='white-space: nowrap'>solution</span></a>

for a the call to <a href="optimize_fixed.htm" target="_top"><span style='white-space: nowrap'>optimize_fixed</span></a>
 corresponding to

<code><i><font color="black"><span style='white-space: nowrap'>information_rcv</span></font></i></code>
.

<br>
<br>
<b><big><a name="fixed_lower" id="fixed_lower">fixed_lower</a></big></b>
<br>
is the same as
<a href="optimize_fixed.htm#fixed_lower" target="_top"><span style='white-space: nowrap'>fixed_lower</span></a>

in the call to <code><font color="blue">optimize_fixed</font></code> that corresponding to 
<code><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i></code>
.

<br>
<br>
<b><big><a name="fixed_upper" id="fixed_upper">fixed_upper</a></big></b>
<br>
is the same as
<a href="optimize_fixed.htm#fixed_upper" target="_top"><span style='white-space: nowrap'>fixed_upper</span></a>

in the call to <code><font color="blue">optimize_fixed</font></code> that corresponding to 
<code><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i></code>
.

<br>
<br>
<b><big><a name="random_opt" id="random_opt">random_opt</a></big></b>
<br>
is the optimal random effects corresponding to the solution; i.e.

<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_opt</span></font></i><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>mixed_object</span></font></i><font color="blue"><span style='white-space: nowrap'>.optimize_random(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_options</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i><font color="blue"><span style='white-space: nowrap'>.fixed_opt,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_lower</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_upper</span></font></i><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font><i><font color="black"><span style='white-space: nowrap'>random_in</span></font></i><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
</span></font></code>

<code><i><font color="black"><span style='white-space: nowrap'>random_options</span></font></i></code>
,

<code><i><font color="black"><span style='white-space: nowrap'>random_lower</span></font></i></code>
,

<code><i><font color="black"><span style='white-space: nowrap'>random_upper</span></font></i></code>
, and

<code><i><font color="black"><span style='white-space: nowrap'>random_in</span></font></i></code>
, are the same
as in the call to <code><font color="blue">optimize_fixed</font></code> that corresponds to 
<code><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i></code>
.

<br>
<br>
<b><big><a name="Positive Definite" id="Positive Definite">Positive Definite</a></big></b>
<br>
If the <a href="sample_fixed.htm#Theory.Implicit Information" target="_top"><span style='white-space: nowrap'>implicit&nbsp;information</span></a>

matrix is not positive definite, at least one fixed effects is not determined
by the model plus the data.
You should be able to recognize it because its
upper and lower limits are not equal, but the limits appear often
in the simulated values (or it is uniformly distributed between these limits).

<br>
<br>
<b><big><a name="Theory" id="Theory">Theory</a></big></b>


<br>
<br>
<b><a name="Theory.Notation" id="Theory.Notation">Notation</a></b>
<br>
Given two random vectors <small>@(@
u
@)@</small> and <small>@(@
v
@)@</small>,
we use the notation <small>@(@
\B{C}( u , v )
@)@</small>
for the corresponding covariance matrix;
i.e.,
<small>@[@

	\B{C}( u , v )
	=
	\B{E} \left( [ u - \B{E} (u) ] [ v - \B{E} (v) ]^\R{T} \right)

@]@</small>

<br>
<br>
<b><a name="Theory.Unconstrained Subset Covariance" id="Theory.Unconstrained Subset Covariance">Unconstrained Subset Covariance</a></b>
<br>
We use <small>@(@
\tilde{L} ( \theta )
@)@</small> to denote the
<a href="theory.htm#Objective.Total Objective, L(theta)" target="_top"><span style='white-space: nowrap'>total&nbsp;objective</span></a>

as a function of <small>@(@
\theta
@)@</small> and
where the absolute values terms in <a href="fix_likelihood.htm" target="_top"><span style='white-space: nowrap'>fix_likelihood</span></a>
 are excluded.
We use <small>@(@
\tilde{\theta}
@)@</small> for the unconstrained optimal estimate
of the subset of fixed effects and
approximate its auto-covariance by
<small>@[@

	\B{C} ( \tilde{\theta} , \tilde{\theta} )
	=
	H^{-1}

@]@</small>
Here <small>@(@
H
@)@</small> is the Hessian corresponding to
the observed information matrix 
<code><i><font color="black"><span style='white-space: nowrap'>information_rcv</span></font></i></code>
.

<br>
<br>
<b><a name="Theory.Approximate Constraint Equations" id="Theory.Approximate Constraint Equations">Approximate Constraint Equations</a></b>
<br>
Let <small>@(@
n
@)@</small> be the number of fixed effects in <small>@(@
\theta
@)@</small>,
<small>@(@
m
@)@</small> the number of active constraints (not counting bounds),
and the equations <small>@(@
e( \theta ) = b
@)@</small> be the active constraints.
Here <small>@(@
e : \B{R}^n \rightarrow \B{R}^m
@)@</small> and <small>@(@
b \in \B{R}^m
@)@</small>
and the inequality constraints have been converted to equalities at the
active bounds.
Indices 
<code><i><font color="black"><span style='white-space: nowrap'>j</span></font></i></code>
 for which 
<code><i><font color="black"><span style='white-space: nowrap'>fixed_lower</span></font></i><font color="blue"><span style='white-space: nowrap'>[</span></font><i><font color="black"><span style='white-space: nowrap'>j</span></font></i><font color="blue"><span style='white-space: nowrap'>]</span></font></code>

is equal to 
<code><i><font color="black"><span style='white-space: nowrap'>fixed_upper</span></font></i><font color="blue"><span style='white-space: nowrap'>[</span></font><i><font color="black"><span style='white-space: nowrap'>j</span></font></i><font color="blue"><span style='white-space: nowrap'>]</span></font></code>
 are considered even of the
corresponding Lagrange multiplier is zero.
Define the approximate constraint equation by
<small>@[@

b =
e \left( \hat{\theta} \right) + e^{(1)} \left( \hat{\theta} \right)
	\left( \theta - \hat{\theta} \right)

@]@</small>
where <small>@(@
\hat{\theta}
@)@</small> is the optional estimate
for the fixed effects 
<code><i><font color="black"><span style='white-space: nowrap'>solution</span></font></i><font color="blue"><span style='white-space: nowrap'>.fixed_opt</span></font></code>
.

<br>
<br>
<b><a name="Theory.Implicit Information" id="Theory.Implicit Information">Implicit Information</a></b>
<br>
We apply the implicit function theorem to the approximate constraint
equation above to get a representation:
<small>@[@

	\theta_D = C \theta_I + d

@]@</small>
Here <small>@(@
D \in \B{Z}_+^m
@)@</small> is the dependent subset of <small>@(@
\theta
@)@</small>,
<small>@(@
I \in \B{Z}_+^{n-m}
@)@</small> is the independent subset of <small>@(@
\theta
@)@</small>,
<small>@(@
D \cap I = \emptyset
@)@</small>,
<small>@(@
C \in \B{R}^{m \times (n - m)}
@)@</small>,
<small>@(@
d \in \B{R}^m
@)@</small>.
For any <small>@(@
\theta
@)@</small> satisfying the approximate constraint equation,
the corresponding components <small>@(@
\theta_D
@)@</small> and <small>@(@
\theta_I
@)@</small>
satisfy the equation above.
The maximum likelihood problem corresponding to the approximate constraints,
as a function of <small>@(@
\theta_I
@)@</small> alone,
would have the following observed information matrix:
<small>@[@

	H_{I,I} + H_{I,D} C + C^\R{T} H_{D,I} + C^\R{T} H_{D,D} C

@]@</small>
This matrix is the observed implicit information matrix.

<br>
<br>
<b><a name="Theory.Implicit Covariance" id="Theory.Implicit Covariance">Implicit Covariance</a></b>
<br>
The inverse of the implicit information matrix
is called the implicit covariance.


<br>
<br>
<b><big><a name="Example" id="Example">Example</a></big></b>
<br>
The file <a href="sample_fixed.cpp.htm" target="_top"><span style='white-space: nowrap'>sample_fixed.cpp</span></a>
 is an example
and test of <code><font color="blue">sample_fixed</font></code>.

<br>
<br>
<b><big><a name="Other Method" id="Other Method">Other Method</a></big></b>
<br>
The routine <a href="sample_conditional.htm" target="_top"><span style='white-space: nowrap'>sample_conditional</span></a>
, is a old method that is no
longer used for computing these samples.

<br>
<br>
<b><big><a name="2DO" id="2DO">2DO</a></big></b>
<br>
This routine uses dense matrices, perhaps it would be useful
to converting this (and <a href="undetermined.htm" target="_top"><span style='white-space: nowrap'>undetermined</span></a>
) to all sparse matrices.


<hr>Input File: src/eigen/sample_fixed.cpp

</body>
</html>

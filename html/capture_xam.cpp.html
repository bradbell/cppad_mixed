<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="capture_xam.cpp, a, capture, example, and, speed, test" name="keywords" />
<meta content="syntax" name="keywords" />
<meta content="reference" name="keywords" />
<meta content="command, arguments" name="keywords" />
<meta content="random_seed" name="keywords" />
<meta content="number_random" name="keywords" />
<meta content="quasi_fixed" name="keywords" />
<meta content="trace_optimize_fixed" name="keywords" />
<meta content="ipopt_solve" name="keywords" />
<meta content="bool_sparsity" name="keywords" />
<meta content="hold_memory" name="keywords" />
<meta content="derivative_test" name="keywords" />
<meta content="start_near_solution" name="keywords" />
<meta content="number_fixed_samples" name="keywords" />
<meta content="number_locations" name="keywords" />
<meta content="max_population" name="keywords" />
<meta content="mean_population" name="keywords" />
<meta content="mean_logit_probability" name="keywords" />
<meta content="std_logit_probability" name="keywords" />
<meta content="random_constraint" name="keywords" />
<meta content="output" name="keywords" />
<meta content="cppad_mixed_version" name="keywords" />
<meta content="ldlt_cholmod" name="keywords" />
<meta content="optimize_cppad_function" name="keywords" />
<meta content="ndebug_defined" name="keywords" />
<meta content="actual_seed" name="keywords" />
<meta content="initialize_bytes" name="keywords" />
<meta content="initialize_seconds" name="keywords" />
<meta content="optimize_fixed_seconds" name="keywords" />
<meta content="optimize_random_seconds" name="keywords" />
<meta content="information_mat_seconds" name="keywords" />
<meta content="sample_fixed_seconds" name="keywords" />
<meta content="final_bytes" name="keywords" />
<meta content="sum_random_effects" name="keywords" />
<meta content="mean_population_estimate" name="keywords" />
<meta content="mean_logit_probability_estimate" name="keywords" />
<meta content="std_logit_probability_estimate" name="keywords" />
<meta content="mean_population_std" name="keywords" />
<meta content="mean_logit_probability_std" name="keywords" />
<meta content="std_logit_probability_std" name="keywords" />
<meta content="mean_population_ratio" name="keywords" />
<meta content="mean_logit_probability_ratio" name="keywords" />
<meta content="std_probability_ratio" name="keywords" />
<meta content="capture_xam_ok" name="keywords" />
<meta content="example" name="keywords" />
<meta content="notation" name="keywords" />
<meta content="p(y_it|n_i,q_t)" name="keywords" />
<meta content="p(n_i|theta)" name="keywords" />
<meta content="q_t(theta,u)" name="keywords" />
<meta content="m_i" name="keywords" />
<meta content="p(y_i|theta,u)" name="keywords" />
<meta content="p(y|theta,u)" name="keywords" />
<meta content="p(u|theta)" name="keywords" />
<meta content="p(theta)" name="keywords" />
<meta content="p(z|theta)" name="keywords" />
<meta content="c(theta)" name="keywords" />
<meta content="source, code" name="keywords" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="capture_xam.sh" href="capture_xam.sh.html" /><link rel="prev" title="ar1_xam.sh" href="ar1_xam.sh.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.09.29"/>
        <title>capture_xam.cpp - cppad_mixed documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="xrst_root_doc.html"><div class="brand">cppad_mixed  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="xrst_root_doc.html">
  
  
  <span class="sidebar-brand-text">cppad_mixed  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="xrst_table_of_contents.html">Table of Contents</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="cppad_mixed.html">cppad_mixed</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="problem.html">problem</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="install_unix.html">install_unix</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="example_install.sh.html">example_install.sh</a></li>
<li class="toctree-l3"><a class="reference internal" href="run_cmake.sh.html">run_cmake.sh</a></li>
<li class="toctree-l3"><a class="reference internal" href="check_install.sh.html">check_install.sh</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="theory.html">theory</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="base_class.html">base_class</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="derived_ctor.html">derived_ctor</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="derived_ctor.cpp.html">derived_ctor.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="ran_likelihood.html">ran_likelihood</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="ran_likelihood.cpp.html">ran_likelihood.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="fix_likelihood.html">fix_likelihood</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="fix_likelihood.cpp.html">fix_likelihood.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="fix_constraint.html">fix_constraint</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="fix_constraint.cpp.html">fix_constraint.cpp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="initialize.html">initialize</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="optimize_random.html">optimize_random</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="optimize_random.cpp.html">optimize_random.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="optimize_fixed.html">optimize_fixed</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="optimize_fixed.cpp.html">optimize_fixed.cpp</a></li>
<li class="toctree-l4"><a class="reference internal" href="ipopt_options.html">ipopt_options</a></li>
<li class="toctree-l4"><a class="reference internal" href="ipopt_trace.html">ipopt_trace</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="hes_fixed_obj.html">hes_fixed_obj</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="hes_fixed_obj.cpp.html">hes_fixed_obj.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="hes_random_obj.html">hes_random_obj</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="hes_random_obj.cpp.html">hes_random_obj.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="sample_fixed.html">sample_fixed</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="sample_fixed.cpp.html">sample_fixed.cpp</a></li>
<li class="toctree-l4"><a class="reference internal" href="sample_conditional.html">sample_conditional</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="sample_random.html">sample_random</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="sample_random.cpp.html">sample_random.cpp</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="information_mat.html">information_mat</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="information_mat.cpp.html">information_mat.cpp</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="namespace.html">namespace</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="typedef.html">typedef</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="manage_gsl_rng.html">manage_gsl_rng</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="manage_gsl_rng.cpp.html">manage_gsl_rng.cpp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sparse_mat_info.html">sparse_mat_info</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="fixed_solution.html">fixed_solution</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="warm_start_struct.html">warm_start_struct</a></li>
<li class="toctree-l4"><a class="reference internal" href="trace_struct.html">trace_struct</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exception.html">exception</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="user_examples.html">user_examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current has-children"><a class="reference internal" href="speed.html">speed</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l4 has-children"><a class="reference internal" href="ar1_xam.cpp.html">ar1_xam.cpp</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="ar1_xam.sh.html">ar1_xam.sh</a></li>
</ul>
</li>
<li class="toctree-l4 current has-children current-page"><a class="current reference internal" href="#">capture_xam.cpp</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="capture_xam.sh.html">capture_xam.sh</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="abs_density.cpp.html">abs_density.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="no_random.cpp.html">no_random.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="ran_constraint.cpp.html">ran_constraint.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="lasso.cpp.html">lasso.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="data_mismatch.cpp.html">data_mismatch.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="opt_ran_nan.cpp.html">opt_ran_nan.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="warm_start.cpp.html">warm_start.cpp</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="release_notes.html">release_notes</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="whats_new_22.html">whats_new_22</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_21.html">whats_new_21</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_20.html">whats_new_20</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_19.html">whats_new_19</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_18.html">whats_new_18</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_17.html">whats_new_17</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_16.html">whats_new_16</a></li>
<li class="toctree-l3"><a class="reference internal" href="whats_new_15.html">whats_new_15</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="wish_list.html">wish_list</a></li>
<li class="toctree-l2"><a class="reference internal" href="math_notation.html">math_notation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="xrst_index.html">Index</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <p class="hidden"><span class="math notranslate nohighlight">\(\newcommand{\B}[1]{ {\bf #1} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\R}[1]{ {\rm #1} }\)</span>
<span class="math notranslate nohighlight">\(\newcommand{\W}[1]{ \; #1 \; }\)</span></p>
<section id="capture-xam-cpp">
<span id="capture-xam-cpp-name"></span><h1>capture_xam.cpp<a class="headerlink" href="#capture-xam-cpp" title="Permalink to this headline">#</a></h1>
<section id="a-capture-example-and-speed-test">
<span id="capture-xam-cpp-title"></span><span id="index-0"></span><h2>A Capture Example and Speed Test<a class="headerlink" href="#a-capture-example-and-speed-test" title="Permalink to this headline">#</a></h2>
<section id="syntax">
<span id="capture-xam-cpp-syntax"></span><span id="index-1"></span><h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">#</a></h3>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">build/speed/capture_xam</span></code> \</div>
<div class="line">      <em>random_seed</em>  \</div>
<div class="line">      <em>number_random</em>   \</div>
<div class="line">      <em>quasi_fixed</em>  \</div>
<div class="line">      <em>trace_optimize_fixed</em>  \</div>
<div class="line">      <em>ipopt_solve</em>  \</div>
<div class="line">      <em>bool_sparsity</em>  \</div>
<div class="line">      <em>hold_memory</em>  \</div>
<div class="line">      <em>derivative_test</em>  \</div>
<div class="line">      <em>start_near_solution</em>  \</div>
<div class="line">      <em>number_fixed_samples</em>  \</div>
<div class="line">      <em>number_locations</em>  \</div>
<div class="line">      <em>max_population</em>  \</div>
<div class="line">      <em>mean_population</em>  \</div>
<div class="line">      <em>mean_logit_probability</em>  \</div>
<div class="line">      <em>std_logit_probability</em>  \</div>
<div class="line">      <em>random_constraint</em></div>
</div>
</section>
<section id="reference">
<span id="capture-xam-cpp-reference"></span><span id="index-2"></span><h3>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">#</a></h3>
<p>J. Andrew Royle,
Biometrics 60, 108-115 March 2004,
<em>N-Mixture Models for Estimating Population Size</em>
<em>from Spatially Replicated Counts.</em></p>
</section>
<section id="command-arguments">
<span id="capture-xam-cpp-command-arguments"></span><span id="index-3"></span><h3>Command Arguments<a class="headerlink" href="#command-arguments" title="Permalink to this headline">#</a></h3>
<section id="random-seed">
<span id="capture-xam-cpp-command-arguments-random-seed"></span><span id="index-4"></span><h4>random_seed<a class="headerlink" href="#random-seed" title="Permalink to this headline">#</a></h4>
<p>This is a non-negative integer equal to the
seed for the random number generator,
to be specific,
<a class="reference internal" href="manage_gsl_rng.html#manage-gsl-rng-new-gsl-rng-s-in"><span class="std std-ref">s_in</span></a> used during the call to
<code class="docutils literal notranslate"><span class="pre">new_gsl_rng</span></code> .</p>
</section>
<section id="number-random">
<span id="capture-xam-cpp-command-arguments-number-random"></span><span id="index-5"></span><h4>number_random<a class="headerlink" href="#number-random" title="Permalink to this headline">#</a></h4>
<p>This is a positive integer equal to the number of random effects.
This is also equal to the
number of times at which the measurements are made and is denoted by
<span class="math notranslate nohighlight">\(T\)</span> below.</p>
</section>
<section id="quasi-fixed">
<span id="capture-xam-cpp-command-arguments-quasi-fixed"></span><span id="index-6"></span><h4>quasi_fixed<a class="headerlink" href="#quasi-fixed" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> and is the value of
<a class="reference internal" href="derived_ctor.html#derived-ctor-quasi-fixed"><span class="std std-ref">quasi_fixed</span></a> in the
<code class="docutils literal notranslate"><span class="pre">cppad_mixed</span></code> derived class constructor.
The amount of memory used by the
<a class="reference internal" href="derived_ctor.html#derived-ctor-mixed-derived"><span class="std std-ref">mixed_derived</span></a> object,
after the information matrix is computed,
will be similar to after the initialization when <em>quasi_fixed</em> is no.</p>
</section>
<section id="trace-optimize-fixed">
<span id="capture-xam-cpp-command-arguments-trace-optimize-fixed"></span><span id="index-7"></span><h4>trace_optimize_fixed<a class="headerlink" href="#trace-optimize-fixed" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .
If it is yes, a <em>print_level</em>  = 5
<a class="reference internal" href="ipopt_trace.html#ipopt-trace-name"><span class="std std-ref">trace</span></a> of the fixed effects optimization
is included in the program output.
Otherwise the ipopt <em>print_level</em> is zero and
no such trace is printed.</p>
</section>
<section id="ipopt-solve">
<span id="capture-xam-cpp-command-arguments-ipopt-solve"></span><span id="index-8"></span><h4>ipopt_solve<a class="headerlink" href="#ipopt-solve" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .
If it is yes, the <code class="docutils literal notranslate"><span class="pre">CppAD::ipopt::solve</span></code>
routine is used for optimizing the random effects,
otherwise <code class="docutils literal notranslate"><span class="pre">CppAD::mixed::ipopt_random</span></code> is used; see
<a class="reference internal" href="optimize_random.html#optimize-random-options-evaluation-method"><span class="std std-ref">evaluation_method</span></a> .</p>
</section>
<section id="bool-sparsity">
<span id="capture-xam-cpp-command-arguments-bool-sparsity"></span><span id="index-9"></span><h4>bool_sparsity<a class="headerlink" href="#bool-sparsity" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .
If it is yes, boolean sparsity patterns are used for this computation,
otherwise set sparsity patterns are used.</p>
</section>
<section id="hold-memory">
<span id="capture-xam-cpp-command-arguments-hold-memory"></span><span id="index-10"></span><h4>hold_memory<a class="headerlink" href="#hold-memory" title="Permalink to this headline">#</a></h4>
<p>The CppAD memory allocator has a hold memory option will be set by</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">CppAD::thread_alloc::hold_memory</span></code> ( <em>hold_memory</em> );</p>
</div></blockquote>
<p>where <em>hold_memory</em> is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .</p>
</section>
<section id="derivative-test">
<span id="capture-xam-cpp-command-arguments-derivative-test"></span><span id="index-11"></span><h4>derivative_test<a class="headerlink" href="#derivative-test" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .
If it is yes, the derivatives of functions used in the optimization
of the fixed effects are checked for correctness.
(This requires extra time).</p>
</section>
<section id="start-near-solution">
<span id="capture-xam-cpp-command-arguments-start-near-solution"></span><span id="index-12"></span><h4>start_near_solution<a class="headerlink" href="#start-near-solution" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .
If it is yes, the initial point for the optimization
is the value of the fixed effects used to simulate the data.
Otherwise, the initial point is significantly different from this value.</p>
</section>
<section id="number-fixed-samples">
<span id="capture-xam-cpp-command-arguments-number-fixed-samples"></span><span id="index-13"></span><h4>number_fixed_samples<a class="headerlink" href="#number-fixed-samples" title="Permalink to this headline">#</a></h4>
<p>This is a positive integer equal to the number of samples simulated
from the posterior distribution for the fixed effects using
<a class="reference internal" href="sample_fixed.html#sample-fixed-name"><span class="std std-ref">sample_fixed</span></a> .
The samples are used to approximation the
standard deviation for the optimal fixed effects.
One should use a large number of samples (at least 100)
for this purpose.</p>
</section>
<section id="number-locations">
<span id="capture-xam-cpp-command-arguments-number-locations"></span><span id="index-14"></span><h4>number_locations<a class="headerlink" href="#number-locations" title="Permalink to this headline">#</a></h4>
<p>This is a positive integer equal to the
number of locations at which the measurements are made; i.e.
<span class="math notranslate nohighlight">\(R\)</span> in the reference.
Increasing this value increases the amount for each function evaluation,
but does not change the number of fixed or random effects.</p>
</section>
<section id="max-population">
<span id="capture-xam-cpp-command-arguments-max-population"></span><span id="index-15"></span><h4>max_population<a class="headerlink" href="#max-population" title="Permalink to this headline">#</a></h4>
<p>This is a positive integer equal to the
maximum value in the finite summation with respect to
population size; i.e.,
<span class="math notranslate nohighlight">\(K\)</span> in the reference.
This must be greater than any of the simulated number of captures
at any location and time; i.e., and <span class="math notranslate nohighlight">\(y_{i,t}\)</span>.
Also note that <em>max_population</em> does not affect the simulated
data <span class="math notranslate nohighlight">\(y_{i,t}\)</span>.
A suggested value is five times <em>mean_population</em> .
The value of <em>max_population</em> is large enough if increasing it
takes more time but does not make a difference in the optimal fixed effects
(use the same value for the other arguments and same actual seed).</p>
</section>
<section id="mean-population">
<span id="capture-xam-cpp-command-arguments-mean-population"></span><span id="index-16"></span><h4>mean_population<a class="headerlink" href="#mean-population" title="Permalink to this headline">#</a></h4>
<p>This is a positive floating point value equal to the
mean of the Poisson distribution for the population
used to simulate data values;
<span class="math notranslate nohighlight">\(\lambda\)</span> in reference.</p>
</section>
<section id="mean-logit-probability">
<span id="capture-xam-cpp-command-arguments-mean-logit-probability"></span><span id="index-17"></span><h4>mean_logit_probability<a class="headerlink" href="#mean-logit-probability" title="Permalink to this headline">#</a></h4>
<p>This is a positive floating point value equal to the
mean of the logit of the capture probability
(independent of the random effects)
used to simulate data values.
The is also equal to the mean of the random effects.</p>
</section>
<section id="std-logit-probability">
<span id="capture-xam-cpp-command-arguments-std-logit-probability"></span><span id="index-18"></span><h4>std_logit_probability<a class="headerlink" href="#std-logit-probability" title="Permalink to this headline">#</a></h4>
<p>This is a positive floating point value equal to the
standard deviation of the logit of the capture probability
(independent of the random effects)
used to simulate data values.
The is also equal to the standard deviation of the random effects.</p>
</section>
<section id="random-constraint">
<span id="capture-xam-cpp-command-arguments-random-constraint"></span><span id="index-19"></span><h4>random_constraint<a class="headerlink" href="#random-constraint" title="Permalink to this headline">#</a></h4>
<p>This is either <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">no</span></code> .
If it is <code class="docutils literal notranslate"><span class="pre">no</span></code> , there is no
<a class="reference internal" href="problem.html#problem-maximum-likelihood-random-constraints"><span class="std std-ref">random constraint</span></a>
for this example.
If it is <code class="docutils literal notranslate"><span class="pre">yes</span></code> ,
the random constraint is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[0 = \hat{u}_0 ( \theta ) + \cdots + \hat{u}_{T-1} ( \theta )\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(\hat{u} ( \theta )\)</span> is the
<a class="reference internal" href="problem.html#problem-notation-optimal-random-effects-u-theta"><span class="std std-ref">optimal random effects</span></a> .
The corresponding
<a class="reference internal" href="problem.html#problem-notation-random-constraint-matrix-a"><span class="std std-ref">random constraint matrix</span></a>
<span class="math notranslate nohighlight">\(A\)</span> is the row vector of size <span class="math notranslate nohighlight">\(T\)</span> with all ones; i.e.,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[A = [ 1 , \cdots , 1 ] \in \B{R}^{1 \times T}\]</div>
</div>
</section>
</section>
<section id="output">
<span id="capture-xam-cpp-output"></span><span id="index-20"></span><h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">#</a></h3>
<p>Each output name, value pair is written in as <em>name</em> = <em>value</em>
where the amount of spaces surrounding the equal sign is not specified.
All of the pairs listed above are output.
In addition, the following name value pairs are also output.</p>
<section id="cppad-mixed-version">
<span id="capture-xam-cpp-output-cppad-mixed-version"></span><span id="index-21"></span><h4>cppad_mixed_version<a class="headerlink" href="#cppad-mixed-version" title="Permalink to this headline">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">cppad_mixed</span></code> version number.</p>
</section>
<section id="ldlt-cholmod">
<span id="capture-xam-cpp-output-ldlt-cholmod"></span><span id="index-22"></span><h4>ldlt_cholmod<a class="headerlink" href="#ldlt-cholmod" title="Permalink to this headline">#</a></h4>
<p>is the <code class="docutils literal notranslate"><span class="pre">bin/run_cmake.sh</span></code> configuration option
<a class="reference internal" href="run_cmake.sh.html#run-cmake-sh-ldlt-cholmod"><span class="std std-ref">ldlt_cholmod</span></a> .</p>
</section>
<section id="optimize-cppad-function">
<span id="capture-xam-cpp-output-optimize-cppad-function"></span><span id="index-23"></span><h4>optimize_cppad_function<a class="headerlink" href="#optimize-cppad-function" title="Permalink to this headline">#</a></h4>
<p>is the <code class="docutils literal notranslate"><span class="pre">bin/run_cmake.sh</span></code> configuration option
<a class="reference internal" href="run_cmake.sh.html#run-cmake-sh-optimize-cppad-function"><span class="std std-ref">optimize_cppad_function</span></a> .</p>
</section>
<section id="ndebug-defined">
<span id="capture-xam-cpp-output-ndebug-defined"></span><span id="index-24"></span><h4>ndebug_defined<a class="headerlink" href="#ndebug-defined" title="Permalink to this headline">#</a></h4>
<p>is the <code class="docutils literal notranslate"><span class="pre">NDEBUG</span></code> preprocessor symbol defined.
This should be yes (no) if the <code class="docutils literal notranslate"><span class="pre">bin/run_cmake.sh</span></code> configuration option
<a class="reference internal" href="run_cmake.sh.html#run-cmake-sh-build-type"><span class="std std-ref">build_type</span></a> is <code class="docutils literal notranslate"><span class="pre">release</span></code>
(<code class="docutils literal notranslate"><span class="pre">debug</span></code> ).</p>
</section>
<section id="actual-seed">
<span id="capture-xam-cpp-output-actual-seed"></span><span id="index-25"></span><h4>actual_seed<a class="headerlink" href="#actual-seed" title="Permalink to this headline">#</a></h4>
<p>If <em>random_seed</em> is zero,
the system clock, instead of <em>random_seed</em> ,
is used to seed the random number generator.
The actual random seed <em>actual_seed</em> is printed
so that you can reproduce results when <em>random_seed</em> is zero.</p>
</section>
<section id="initialize-bytes">
<span id="capture-xam-cpp-output-initialize-bytes"></span><span id="index-26"></span><h4>initialize_bytes<a class="headerlink" href="#initialize-bytes" title="Permalink to this headline">#</a></h4>
<p>Is the amount of heap memory, in bytes,
added to the program during its <a class="reference internal" href="initialize.html#initialize-name"><span class="std std-ref">initialize</span></a> call.
Note that more temporary memory may have been used during this call.
In addition, only memory allocated using <code class="docutils literal notranslate"><span class="pre">CppAD::thread_alloc</span></code> is
included.</p>
</section>
<section id="initialize-seconds">
<span id="capture-xam-cpp-output-initialize-seconds"></span><span id="index-27"></span><h4>initialize_seconds<a class="headerlink" href="#initialize-seconds" title="Permalink to this headline">#</a></h4>
<p>Is the number of seconds used by the derived class <a class="reference internal" href="initialize.html#initialize-name"><span class="std std-ref">initialize</span></a> call.</p>
</section>
<section id="optimize-fixed-seconds">
<span id="capture-xam-cpp-output-optimize-fixed-seconds"></span><span id="index-28"></span><h4>optimize_fixed_seconds<a class="headerlink" href="#optimize-fixed-seconds" title="Permalink to this headline">#</a></h4>
<p>Is the number of seconds used by the call to
<a class="reference internal" href="optimize_fixed.html#optimize-fixed-name"><span class="std std-ref">optimize_fixed</span></a> that is used to compute the
optimal fixed effects.</p>
</section>
<section id="optimize-random-seconds">
<span id="capture-xam-cpp-output-optimize-random-seconds"></span><span id="index-29"></span><h4>optimize_random_seconds<a class="headerlink" href="#optimize-random-seconds" title="Permalink to this headline">#</a></h4>
<p>Is the number of seconds used by a single call to
<a class="reference internal" href="optimize_random.html#optimize-random-name"><span class="std std-ref">optimize_random</span></a> that is used to compute the
optimal random effects.</p>
</section>
<section id="information-mat-seconds">
<span id="capture-xam-cpp-output-information-mat-seconds"></span><span id="index-30"></span><h4>information_mat_seconds<a class="headerlink" href="#information-mat-seconds" title="Permalink to this headline">#</a></h4>
<p>Is the number of seconds used by the call to
<a class="reference internal" href="information_mat.html#information-mat-name"><span class="std std-ref">information_mat</span></a> that computes the observed information matrix.</p>
</section>
<section id="sample-fixed-seconds">
<span id="capture-xam-cpp-output-sample-fixed-seconds"></span><span id="index-31"></span><h4>sample_fixed_seconds<a class="headerlink" href="#sample-fixed-seconds" title="Permalink to this headline">#</a></h4>
<p>Is the number of seconds used by the call to
<a class="reference internal" href="sample_fixed.html#sample-fixed-name"><span class="std std-ref">sample_fixed</span></a> that computes the
<a class="reference internal" href="#capture-xam-cpp-command-arguments-number-fixed-samples"><span class="std std-ref">number_sample_fixed</span></a>
samples for the fixed effects.</p>
</section>
<section id="final-bytes">
<span id="capture-xam-cpp-output-final-bytes"></span><span id="index-32"></span><h4>final_bytes<a class="headerlink" href="#final-bytes" title="Permalink to this headline">#</a></h4>
<p>Is final amount of heap memory, in bytes, added and retained by the program.
Only memory allocated using <code class="docutils literal notranslate"><span class="pre">CppAD::thread_alloc</span></code> is included.</p>
</section>
<section id="sum-random-effects">
<span id="capture-xam-cpp-output-sum-random-effects"></span><span id="index-33"></span><h4>sum_random_effects<a class="headerlink" href="#sum-random-effects" title="Permalink to this headline">#</a></h4>
<p>Is the sum of the optimal random effects.</p>
</section>
<section id="mean-population-estimate">
<span id="capture-xam-cpp-output-mean-population-estimate"></span><span id="index-34"></span><h4>mean_population_estimate<a class="headerlink" href="#mean-population-estimate" title="Permalink to this headline">#</a></h4>
<p>Is the estimate for the
<a class="reference internal" href="#capture-xam-cpp-command-arguments-mean-population"><span class="std std-ref">mean_population</span></a>
computed by <a class="reference internal" href="optimize_fixed.html#optimize-fixed-name"><span class="std std-ref">optimize_fixed</span></a> .</p>
</section>
<section id="mean-logit-probability-estimate">
<span id="capture-xam-cpp-output-mean-logit-probability-estimate"></span><span id="index-35"></span><h4>mean_logit_probability_estimate<a class="headerlink" href="#mean-logit-probability-estimate" title="Permalink to this headline">#</a></h4>
<p>Is the optimal estimate for the
<a class="reference internal" href="#capture-xam-cpp-command-arguments-mean-logit-probability"><span class="std std-ref">mean_logit_probability</span></a>
(computed by <a class="reference internal" href="optimize_fixed.html#optimize-fixed-name"><span class="std std-ref">optimize_fixed</span></a> ).</p>
</section>
<section id="std-logit-probability-estimate">
<span id="capture-xam-cpp-output-std-logit-probability-estimate"></span><span id="index-36"></span><h4>std_logit_probability_estimate<a class="headerlink" href="#std-logit-probability-estimate" title="Permalink to this headline">#</a></h4>
<p>Is the optimal estimate for the
<a class="reference internal" href="#capture-xam-cpp-command-arguments-std-logit-probability"><span class="std std-ref">std_logit_probability</span></a> .</p>
</section>
<section id="mean-population-std">
<span id="capture-xam-cpp-output-mean-population-std"></span><span id="index-37"></span><h4>mean_population_std<a class="headerlink" href="#mean-population-std" title="Permalink to this headline">#</a></h4>
<p>Is the sample standard deviation of <em>mean_population_estimate</em>
(corresponding to the sample computed by <a class="reference internal" href="sample_fixed.html#sample-fixed-name"><span class="std std-ref">sample_fixed</span></a> ).</p>
</section>
<section id="mean-logit-probability-std">
<span id="capture-xam-cpp-output-mean-logit-probability-std"></span><span id="index-38"></span><h4>mean_logit_probability_std<a class="headerlink" href="#mean-logit-probability-std" title="Permalink to this headline">#</a></h4>
<p>Is the sample standard deviation of <em>mean_logit_probability_estimate</em> .</p>
</section>
<section id="std-logit-probability-std">
<span id="capture-xam-cpp-output-std-logit-probability-std"></span><span id="index-39"></span><h4>std_logit_probability_std<a class="headerlink" href="#std-logit-probability-std" title="Permalink to this headline">#</a></h4>
<p>Is the sample standard deviation of <em>std_logit_probability_estimate</em> .</p>
</section>
<section id="mean-population-ratio">
<span id="capture-xam-cpp-output-mean-population-ratio"></span><span id="index-40"></span><h4>mean_population_ratio<a class="headerlink" href="#mean-population-ratio" title="Permalink to this headline">#</a></h4>
<div class="line-block">
<div class="line">( <em>mean_population_estimate</em> <code class="docutils literal notranslate"><span class="pre">-</span></code> <em>mean_population</em>  ) /</div>
<div class="line">      <em>mean_population_std</em></div>
</div>
</section>
<section id="mean-logit-probability-ratio">
<span id="capture-xam-cpp-output-mean-logit-probability-ratio"></span><span id="index-41"></span><h4>mean_logit_probability_ratio<a class="headerlink" href="#mean-logit-probability-ratio" title="Permalink to this headline">#</a></h4>
<div class="line-block">
<div class="line">( <em>mean_logit_probability_estimate</em> <code class="docutils literal notranslate"><span class="pre">-</span></code> <em>mean_logit_probability</em>  ) /</div>
<div class="line">      <em>mean_logit_probability_std</em></div>
</div>
</section>
<section id="std-probability-ratio">
<span id="capture-xam-cpp-output-std-probability-ratio"></span><span id="index-42"></span><h4>std_probability_ratio<a class="headerlink" href="#std-probability-ratio" title="Permalink to this headline">#</a></h4>
<div class="line-block">
<div class="line">( <em>std_probability_estimate</em> <code class="docutils literal notranslate"><span class="pre">-</span></code> <em>std_probability</em>  ) /</div>
<div class="line">      <em>std_probability_std</em></div>
</div>
</section>
<section id="capture-xam-ok">
<span id="capture-xam-cpp-output-capture-xam-ok"></span><span id="index-43"></span><h4>capture_xam_ok<a class="headerlink" href="#capture-xam-ok" title="Permalink to this headline">#</a></h4>
<p>The following conditions are checked. If they are all true,
<em>capture_xam_ok</em> is yes. Otherwise it is no.</p>
<ol class="arabic simple">
<li><p><em>sum_random_effects</em> &lt; 1 <code class="docutils literal notranslate"><span class="pre">e-8</span></code> || ( <em>random_constraint</em> == <code class="docutils literal notranslate"><span class="pre">no</span></code> )</p></li>
<li><p><em>mean_population_ratio</em>  &lt; 5.0</p></li>
<li><p><em>mean_logit_probability_ratio</em>  &lt; 5.0</p></li>
<li><p><em>std_logit_probability_ratio</em>  &lt; 5.0</p></li>
</ol>
<p>If <em>capture_xam_ok</em> is yes, the program return value is
<code class="docutils literal notranslate"><span class="pre">0</span></code> (no error condition).
Otherwise it is <code class="docutils literal notranslate"><span class="pre">1</span></code> (error condition).</p>
</section>
</section>
<section id="example">
<span id="capture-xam-cpp-example"></span><span id="index-44"></span><h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h3>
<p>The file <a class="reference internal" href="capture_xam.sh.html#capture-xam-sh-name"><span class="std std-ref">capture_xam.sh</span></a> is an example using this program.</p>
</section>
<section id="notation">
<span id="capture-xam-cpp-notation"></span><span id="index-45"></span><h3>Notation<a class="headerlink" href="#notation" title="Permalink to this headline">#</a></h3>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(R\)</span></p></td>
<td><p>number of sampling locations; i.e., <em>number_locations</em> .</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T\)</span></p></td>
<td><p>number of sampling times; i.e., <em>number_random</em> .</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(K\)</span></p></td>
<td><p>maximum population in truncation of infinite summation; i.e.,
<em>max_population</em></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\theta_0\)</span></p></td>
<td><p>mean for <span class="math notranslate nohighlight">\(N_i\)</span> given <span class="math notranslate nohighlight">\(\theta\)</span>
(<span class="math notranslate nohighlight">\(\lambda\)</span> in reference); i.e.,
<em>mean_population</em> .</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\theta_1\)</span></p></td>
<td><p>mean of logit of capture probability; i.e.,
<em>mean_logit_probability</em> .</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\theta_2\)</span></p></td>
<td><p>standard deviation of logit of capture probability; i.e.,
<em>std_logit_probability</em> .</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(N_i\)</span></p></td>
<td><p>size of the population at <em>i</em>-th location</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(y_{i,t}\)</span></p></td>
<td><p>number of captures at location <span class="math notranslate nohighlight">\(i\)</span> and time <span class="math notranslate nohighlight">\(t\)</span>
(<span class="math notranslate nohighlight">\(n_{i,t}\)</span> in reference)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(y_i\)</span></p></td>
<td><p>is the vector of captures at location <span class="math notranslate nohighlight">\(i\)</span>
<span class="math notranslate nohighlight">\(( y_{i,0} , \ldots , y_{i, T-1} )\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(M_i\)</span></p></td>
<td><p>maximum of captures at <em>i</em>-th location
(<span class="math notranslate nohighlight">\(\max_t n_{i,t}\)</span> in reference)</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(q_t\)</span></p></td>
<td><p>capture probability at <span class="math notranslate nohighlight">\(t\)</span> same for all locations
(<span class="math notranslate nohighlight">\(p_{i,t}\)</span> in reference)</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(u_t\)</span></p></td>
<td><p>random effect for each sampling time</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="p-y-it-n-i-q-t">
<span id="capture-xam-cpp-p-y-it-n-i-q-t"></span><span id="index-46"></span><h3>p(y_it|N_i,q_t)<a class="headerlink" href="#p-y-it-n-i-q-t" title="Permalink to this headline">#</a></h3>
<p>We use a binomial distribution to model the
probability of <span class="math notranslate nohighlight">\(y_{i,t}\)</span> given <span class="math notranslate nohighlight">\(N_i\)</span> and <span class="math notranslate nohighlight">\(q_t\)</span>; i.e,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\B{p} ( y_{i,t} | N_i , q_t )
=
\left( \begin{array}{c} N_i \\ y_{i,t} \end{array} \right)
q_t^{y(i,t)} \left( 1 - q_t \right)^{y(i,t)}\end{split}\]</div>
</div>
<p>Furthermore, we assume that this probability
is independent for each <span class="math notranslate nohighlight">\((i, t)\)</span>.</p>
</section>
<section id="p-n-i-theta">
<span id="capture-xam-cpp-p-n-i-theta"></span><span id="index-47"></span><h3>p(N_i|theta)<a class="headerlink" href="#p-n-i-theta" title="Permalink to this headline">#</a></h3>
<p>We use a Poisson distribution to model the
probability of <span class="math notranslate nohighlight">\(N_i\)</span> given <span class="math notranslate nohighlight">\(\theta_0\)</span>; i.e.,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\B{p} ( N_i | \theta  )
=
\theta_0^{N(i)} \frac{ \exp[ - \theta_0 ] }{ N_i ! }\]</div>
</div>
<p>We assume these this probability
is independent for each <span class="math notranslate nohighlight">\(i\)</span>.</p>
</section>
<section id="q-t-theta-u">
<span id="capture-xam-cpp-q-t-theta-u"></span><span id="index-48"></span><h3>q_t(theta,u)<a class="headerlink" href="#q-t-theta-u" title="Permalink to this headline">#</a></h3>
<p>Section 2.4 of the
<a class="reference internal" href="#capture-xam-cpp-reference"><span class="std std-ref">Reference</span></a> suggests a
covariate model for the probability of capture.
We use a similar model defined by</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\R{logit} ( q_t ) = u_t + \theta_1\]</div>
</div>
<p>It follows that</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[q_t( \theta , u) = [ 1 + \exp(- u_t - \theta_1 ) ]^{-1}\]</div>
</div>
</section>
<section id="m-i">
<span id="capture-xam-cpp-m-i"></span><span id="index-49"></span><h3>M_i<a class="headerlink" href="#m-i" title="Permalink to this headline">#</a></h3>
<p>We define the vector of maximum measurement for each location by</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[M_i = \max \left\{ y_{i,0} , \cdots , y_{i, T-1} \right\}\]</div>
</div>
</section>
<section id="p-y-i-theta-u">
<span id="capture-xam-cpp-p-y-i-theta-u"></span><span id="index-50"></span><h3>p(y_i|theta,u)<a class="headerlink" href="#p-y-i-theta-u" title="Permalink to this headline">#</a></h3>
<p>The probability for <span class="math notranslate nohighlight">\(y_i\)</span> (the captures at location <span class="math notranslate nohighlight">\(i\)</span>)
given <span class="math notranslate nohighlight">\(N_i\)</span>, <span class="math notranslate nohighlight">\(\theta\)</span>, and <span class="math notranslate nohighlight">\(u\)</span> is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\B{p}( y_i | N_i, \theta , u )
=
\prod_{t=0}^{T-1}
\left( \begin{array}{c} {N(i)} \\ y_{i,t} \end{array} \right)
   q_t ( \theta , u)^{y(i,t)}
   \left( 1 - q_t( \theta , u) \right)^{y(i,t)}\end{split}\]</div>
</div>
<p>We do not know the population at each location <span class="math notranslate nohighlight">\(N_i\)</span>,
but instead have a Poisson prior for <span class="math notranslate nohighlight">\(N_i\)</span>.
We sum with respect to the possible values for <span class="math notranslate nohighlight">\(N_i\)</span>
to get the probability of <span class="math notranslate nohighlight">\(y_i\)</span> given
<span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(u\)</span>.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\B{p}( y_i | \theta , u )
=
\sum_{k=0}^K \B{p}( y_i | N_i=k, \theta , u ) \B{p}( N_i=k | \theta )\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(k\)</span> is the possible values for <span class="math notranslate nohighlight">\(N_i\)</span>.
Note that <span class="math notranslate nohighlight">\(K\)</span> should be plus infinity, but we use a fixed
finite value for <span class="math notranslate nohighlight">\(K\)</span> as an approximation for the infinite sum.</p>
</section>
<section id="p-y-theta-u">
<span id="capture-xam-cpp-p-y-theta-u"></span><span id="index-51"></span><h3>p(y|theta,u)<a class="headerlink" href="#p-y-theta-u" title="Permalink to this headline">#</a></h3>
<p>Our model for the likelihood of the data at all the locations,
given the fixed and random effects, is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\B{p}( y | \theta , u )
=
\prod_{i=0}^{R-1} \B{p}( y_i | \theta , u )\]</div>
</div>
<p>Expressed in terms of fixed effects <span class="math notranslate nohighlight">\(\theta\)</span>,
the random effects <span class="math notranslate nohighlight">\(u\)</span>,
and the data <span class="math notranslate nohighlight">\(y\)</span>, this is</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\B{p}( y | \theta , u )
=
\prod_{i=0}^{R-1}
\left[
\sum_{k=0}^{K-1}
\theta_0^k \frac{ \exp[ - \theta_0 ] }{ k ! }
\prod_{t=0}^{T-1}
\left( \begin{array}{c} {k} \\ y_{i,t} \end{array} \right)
   q_t ( \theta , u)^{y(i,t)}
   \left( 1 - q_t( \theta , u) \right)^{y(i,t)}
\right]\end{split}\]</div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">cppad_mixed</span></code> notation, this specifies the
<a class="reference internal" href="problem.html#problem-notation-random-data-density-p-y-theta-u"><span class="std std-ref">random data density</span></a> .</p>
</section>
<section id="p-u-theta">
<span id="capture-xam-cpp-p-u-theta"></span><span id="index-52"></span><h3>p(u|theta)<a class="headerlink" href="#p-u-theta" title="Permalink to this headline">#</a></h3>
<p>We use a normal distribution, with mean zero and standard deviation
<span class="math notranslate nohighlight">\(\theta_2\)</span>,
for the distribution of the random effects <span class="math notranslate nohighlight">\(u\)</span>
given the fixed effects <span class="math notranslate nohighlight">\(\theta\)</span>; i.e.,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\B{p} ( u | \theta )
=
\prod_{t=0}^{T-1}
   \frac{1}{ \theta_2 \sqrt{ 2 \pi } }
      \exp \left[ - \frac{1}{2} \frac{ u_t^2 }{ \theta_2^2 } \right]\]</div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">cppad_mixed</span></code> notation, this specifies the
<a class="reference internal" href="problem.html#problem-notation-random-prior-density-p-u-theta"><span class="std std-ref">random prior density</span></a> .</p>
</section>
<section id="p-theta">
<span id="capture-xam-cpp-p-theta"></span><span id="index-53"></span><h3>p(theta)<a class="headerlink" href="#p-theta" title="Permalink to this headline">#</a></h3>
<p>For this example there is no
<a class="reference internal" href="problem.html#problem-notation-fixed-prior-density-p-theta"><span class="std std-ref">fixed prior density</span></a>
<span class="math notranslate nohighlight">\(\B{p}(\theta)\)</span>.</p>
</section>
<section id="p-z-theta">
<span id="capture-xam-cpp-p-z-theta"></span><span id="index-54"></span><h3>p(z|theta)<a class="headerlink" href="#p-z-theta" title="Permalink to this headline">#</a></h3>
<p>For this example there is no
<a class="reference internal" href="problem.html#problem-notation-fixed-data-density-p-z-theta"><span class="std std-ref">fixed data density</span></a>
<span class="math notranslate nohighlight">\(\B{p}(z | \theta)\)</span>.</p>
</section>
<section id="c-theta">
<span id="capture-xam-cpp-c-theta"></span><span id="index-55"></span><h3>c(theta)<a class="headerlink" href="#c-theta" title="Permalink to this headline">#</a></h3>
<p>For this example there is no
<a class="reference internal" href="problem.html#problem-notation-fixed-constraint-function-c-theta"><span class="std std-ref">fixed constraint function</span></a>
<span class="math notranslate nohighlight">\(c( \theta )\)</span>.</p>
</section>
<section id="source-code">
<span id="capture-xam-cpp-source-code"></span><span id="index-56"></span><h3>Source Code<a class="headerlink" href="#source-code" title="Permalink to this headline">#</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;gsl/gsl_randist.h&gt;</span><span class="cp"></span>
<span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cppad/utility/vector.hpp&gt;</span><span class="cp"></span>
<span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cppad/utility/elapsed_seconds.hpp&gt;</span><span class="cp"></span>
<span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cppad/mixed/cppad_mixed.hpp&gt;</span><span class="cp"></span>
<span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cppad/mixed/manage_gsl_rng.hpp&gt;</span><span class="cp"></span>
<span class="cp">#</span><span class="w"> </span><span class="cp">include</span><span class="w"> </span><span class="cpf">&lt;cppad/mixed/configure.hpp&gt;</span><span class="cp"></span>

<span class="k">namespace</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// BEGIN_EMPTY_NAMESPACE</span>
<span class="c1">//</span>
<span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exp</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">log</span><span class="p">;</span><span class="w"></span>
<span class="c1">//</span>
<span class="k">using</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">s_vector</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">d_vector</span><span class="p">;</span><span class="w"></span>
<span class="k">using</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">d_sparse_rcv</span><span class="p">;</span><span class="w"></span>
<span class="c1">//</span>
<span class="c1">// Convert size_t to string adding commas every three digits</span>
<span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">size_t2string</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">raw_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw_string</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_raw</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">n_raw</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">raw_string</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// simulate data, y</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">simulate</span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w">                   </span><span class="n">random_constraint</span><span class="w"> </span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w">                 </span><span class="n">R</span><span class="w">                 </span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w">                 </span><span class="n">T</span><span class="w">                 </span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">d_vector</span><span class="o">&amp;</span><span class="w">        </span><span class="n">theta</span><span class="w">             </span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="n">s_vector</span><span class="o">&amp;</span><span class="w">              </span><span class="n">y</span><span class="w">                 </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">theta</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// random number generator</span>
<span class="w">   </span><span class="n">gsl_rng</span><span class="o">*</span><span class="w"> </span><span class="n">rng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">get_gsl_rng</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// simulate population sizes</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">N</span><span class="p">(</span><span class="n">R</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsl_ran_poisson</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// simulate random effects</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">sum</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsl_ran_gaussian</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">// adjust the random effects when using random constraint</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">random_constraint</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="c1">// simulate mean zero values</span>
<span class="w">         </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="c1">// correct for loss of one degree of freedom</span>
<span class="w">         </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="n">T</span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">// simulate data</span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="c1">// probability of capture</span>
<span class="w">         </span><span class="kt">double</span><span class="w"> </span><span class="n">ex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="kt">double</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="mf">1.0</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">y</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsl_ran_binomial</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// cppad_mixed derived class</span>
<span class="k">class</span><span class="w"> </span><span class="nc">mixed_derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">cppad_mixed</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w">          </span><span class="n">R_</span><span class="p">;</span><span class="w"> </span><span class="c1">// number of locations</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w">          </span><span class="n">T_</span><span class="p">;</span><span class="w"> </span><span class="c1">// number of times</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w">                </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="c1">// max used when summing over population size</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="n">s_vector</span><span class="o">&amp;</span><span class="w">       </span><span class="n">y_</span><span class="p">;</span><span class="w"> </span><span class="c1">// reference to data values</span>
<span class="w">   </span><span class="c1">// -----------------------------------------------------------------</span>
<span class="w">   </span><span class="c1">// set by constructor and then effectively const</span>
<span class="w">   </span><span class="n">s_vector</span><span class="w">        </span><span class="n">M_</span><span class="p">;</span><span class="w">       </span><span class="c1">// max number of captures at each location</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w">        </span><span class="n">logfac_</span><span class="p">;</span><span class="w">  </span><span class="c1">// logfac_[k] = log( k! )</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w">        </span><span class="n">log_pik_</span><span class="p">;</span><span class="w"> </span><span class="c1">// used by implement_ran_likelihood</span>
<span class="c1">// ------------------------------------------------------------------------</span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="c1">// constructor</span>
<span class="w">   </span><span class="n">mixed_derived</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">size_t</span><span class="w">                  </span><span class="n">R</span><span class="w">             </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">size_t</span><span class="w">                  </span><span class="n">T</span><span class="w">             </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">size_t</span><span class="w">                  </span><span class="n">K</span><span class="w">             </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w">                    </span><span class="n">quasi_fixed</span><span class="w">   </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="kt">bool</span><span class="w">                    </span><span class="n">bool_sparsity</span><span class="w"> </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">d_sparse_rcv</span><span class="o">&amp;</span><span class="w">     </span><span class="n">A_rcv</span><span class="w">         </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">s_vector</span><span class="o">&amp;</span><span class="w">               </span><span class="n">y</span><span class="w">             </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">d_vector</span><span class="o">&amp;</span><span class="w">               </span><span class="n">fixed_in</span><span class="w">      </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">d_vector</span><span class="o">&amp;</span><span class="w">               </span><span class="n">random_in</span><span class="w">     </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="c1">// n_fixed = 3, n_random = T</span>
<span class="w">      </span><span class="n">cppad_mixed</span><span class="p">(</span><span class="w"></span>
<span class="w">         </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">quasi_fixed</span><span class="p">,</span><span class="w"> </span><span class="n">bool_sparsity</span><span class="p">,</span><span class="w"> </span><span class="n">A_rcv</span><span class="w"></span>
<span class="w">      </span><span class="p">)</span><span class="w">                </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">R_</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w">            </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">T_</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w">            </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">K_</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="w">            </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">y_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">fixed_in</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">random_in</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// set M_</span>
<span class="w">      </span><span class="n">M_</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">R</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="w"> </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// set logfac_</span>
<span class="w">      </span><span class="n">logfac_</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">K_</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">logfac_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">logfac_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">logfac_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">logfac_</span><span class="p">[</span><span class="n">k</span><span class="mi">-1</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// set log_pik_</span>
<span class="w">      </span><span class="n">log_pik_</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">R_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ell</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="n">ell</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">log_pik_</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">template_ran_likelihood</span><span class="p">(</span><span class="n">fixed_in</span><span class="p">,</span><span class="w"> </span><span class="n">random_in</span><span class="p">,</span><span class="w"> </span><span class="n">log_pik_</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">// implementaion of ran_likelihood, used with Float = double and a1_double</span>
<span class="w">   </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">Float</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">   </span><span class="n">CppAD</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">template_ran_likelihood</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;&amp;</span><span class="w">  </span><span class="n">theta</span><span class="w">   </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;&amp;</span><span class="w">  </span><span class="n">u</span><span class="w">       </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">CppAD</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;&amp;</span><span class="w">        </span><span class="n">log_pik</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">vector</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">log_pik</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R_</span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vec</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="n">Float</span><span class="w"> </span><span class="nf">one</span><span class="p">(</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">Float</span><span class="w"> </span><span class="nf">two</span><span class="p">(</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">Float</span><span class="w"> </span><span class="nf">pi2</span><span class="p">(</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atan</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">Float</span><span class="w"> </span><span class="n">eps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="w"> </span><span class="mf">10.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">epsilon</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">//  ------------------------------------------------------------</span>
<span class="w">      </span><span class="c1">// log [ p(u | theta) ]</span>
<span class="w">      </span><span class="c1">//  ------------------------------------------------------------</span>
<span class="w">      </span><span class="n">Float</span><span class="w"> </span><span class="n">sig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="n">T_</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="w"> </span><span class="n">pi2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T_</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="n">Float</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sig</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eps</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">two</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c1">//  ------------------------------------------------------------</span>
<span class="w">      </span><span class="c1">// log [ p(y | theta, u) ]</span>
<span class="w">      </span><span class="c1">//  ------------------------------------------------------------</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// y_{i,t} * log( qt )</span>
<span class="w">      </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">yit_log_q</span><span class="p">(</span><span class="n">R_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T_</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// log( 1.0 - qt )</span>
<span class="w">      </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">log_1q</span><span class="p">(</span><span class="n">T_</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T_</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="n">Float</span><span class="w"> </span><span class="n">ex</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">Float</span><span class="w"> </span><span class="n">q</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ex</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">log_1q</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="n">one</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eps</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R_</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">yit_log_q</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="n">y_</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">T_</span><span class="o">+</span><span class="n">t</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eps</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// log( theta[0]^k * exp( - theta[0] ) / k! )</span>
<span class="w">      </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">log_poisson</span><span class="p">(</span><span class="n">K_</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="n">log_poisson</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="w"> </span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eps</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="n">log_poisson</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">         </span><span class="n">log_poisson</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">logfac_</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// log[ p(y|theta, u) ] to vec[0]</span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R_</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="c1">// compute maximum of log_pik for this i</span>
<span class="w">         </span><span class="n">Float</span><span class="w"> </span><span class="n">max_log_pik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log_pik</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">];</span><span class="w"></span>
<span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">log_pik</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max_log_pik</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">               </span><span class="n">max_log_pik</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log_pik</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">];</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="c1">//</span>
<span class="w">         </span><span class="c1">// initialize p(y_i|theta,u)</span>
<span class="w">         </span><span class="n">Float</span><span class="w"> </span><span class="n">p_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M_</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="p">{</span><span class="w">  </span><span class="c1">// compute p(y_i|N_i=k,theta,u) p(N_i=k|theta)</span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// initialize sum that needs to be calculated with Float</span>
<span class="w">            </span><span class="c1">// p(N_i=k|theta)</span>
<span class="w">            </span><span class="n">Float</span><span class="w"> </span><span class="n">float_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log_poisson</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// initialize sum that does not need to use Float</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">double_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// now compute terms that depend on t</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T_</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">yit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">];</span><span class="w"></span>
<span class="w">               </span><span class="c1">//</span>
<span class="w">               </span><span class="c1">// k choose yit = k! / [ yit! * (k - yit)! ]</span>
<span class="w">               </span><span class="c1">// log [ (k choose yit) ]</span>
<span class="w">               </span><span class="n">double_sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">logfac_</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">logfac_</span><span class="p">[</span><span class="n">yit</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">logfac_</span><span class="p">[</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yit</span><span class="p">];</span><span class="w"></span>
<span class="w">               </span><span class="c1">//</span>
<span class="w">               </span><span class="c1">// log ( qt^yit )</span>
<span class="w">               </span><span class="n">float_sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">yit_log_q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">];</span><span class="w"></span>
<span class="w">               </span><span class="c1">//</span>
<span class="w">               </span><span class="c1">// log [ (1 - qt)^(k - yit) ]</span>
<span class="w">               </span><span class="n">float_sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">Float</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">yit</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log_1q</span><span class="p">[</span><span class="n">t</span><span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="c1">// log[ p(y_i|N_i=k,theta,u) p(N_i=k|theta)</span>
<span class="w">            </span><span class="c1">// (output elements of log_pik are not affected by its input)</span>
<span class="w">            </span><span class="n">log_pik</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float_sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">double_sum</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// normalization avoids exponential overflow</span>
<span class="w">            </span><span class="c1">// p_i += p(y_i|N_i=k,theta,u) p(N_i=k|theta) / exp(max_log_pik)</span>
<span class="w">            </span><span class="n">p_i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="w"> </span><span class="n">log_pik</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">max_log_pik</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="c1">// vec[0] += log[ p(y_i|theta,u) ]</span>
<span class="w">         </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="w"> </span><span class="n">p_i</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">         </span><span class="c1">// following term does not depend on the fixed or random effects</span>
<span class="w">         </span><span class="c1">// vec[0] += Float(K_ - M_[i]) * max_log_pik;</span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="c1">// - log [ p(y|theta,u) p(u|theta) ]</span>
<span class="w">      </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// result may be inifite or nan when only computing log_pik</span>
<span class="w">      </span><span class="c1">// (initial log_pik is used to compute normalization factors)</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">vec</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="c1">// ------------------------------------------------------------------------</span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="c1">// a1_vector ran_likelihood</span>
<span class="w">   </span><span class="k">virtual</span><span class="w"> </span><span class="n">a1_vector</span><span class="w"> </span><span class="n">ran_likelihood</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">a1_vector</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fixed_vec</span><span class="w">  </span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">a1_vector</span><span class="o">&amp;</span><span class="w"> </span><span class="n">random_vec</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="n">a1_vector</span><span class="w"> </span><span class="nf">log_pik</span><span class="p">(</span><span class="n">R_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="p">),</span><span class="w"> </span><span class="n">vec</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ell</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">R_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">K_</span><span class="p">;</span><span class="w"> </span><span class="n">ell</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">log_pik</span><span class="p">[</span><span class="n">ell</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1_double</span><span class="p">(</span><span class="n">log_pik_</span><span class="p">[</span><span class="n">ell</span><span class="p">]);</span><span class="w"></span>
<span class="w">      </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">template_ran_likelihood</span><span class="p">(</span><span class="n">fixed_vec</span><span class="p">,</span><span class="w"> </span><span class="n">random_vec</span><span class="p">,</span><span class="w"> </span><span class="n">log_pik</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">// make sure result is finite</span>
<span class="cp"># ifndef NDEBUG</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">inf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">();</span><span class="w"></span>
<span class="cp"># endif</span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a1_double</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a1_double</span><span class="p">(</span><span class="n">inf</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">vec</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">Value</span><span class="o">&gt;</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">label_print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Value</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">left</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">label</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">label_print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">left</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">label</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">n_digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">log10</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1e-9</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="n">n_digits</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">bool_print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">left</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">label</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; = yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; = no&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// END_EMPTY_NAMESPACE</span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">using</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">arg_name</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;random_seed&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;number_random&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;quasi_fixed&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;trace_optimize_fixed&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;ipopt_solve&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;bool_sparsity&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;hold_memory&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;derivative_test&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;start_near_solution&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;number_fixed_samples&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;number_locations&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;max_population&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;mean_population&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;mean_logit_probability&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;std_logit_probability&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;random_constraint&quot;</span><span class="w"></span>
<span class="w">   </span><span class="p">};</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">arg_name</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">arg_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="kt">size_t</span><span class="p">(</span><span class="n">argc</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n_arg</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="c1">// print usage error message</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;expected &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">n_arg</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; arguments and found &quot;</span><span class="w"></span>
<span class="w">      </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">argc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">usage: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_arg</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; </span><span class="se">\\</span><span class="s"> </span><span class="se">\n\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">arg_name</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// get command line arguments</span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">n_arg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">iarg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">random_seed</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atoi</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">number_random</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atoi</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">quasi_fixed_str</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">trace_optimize_fixed_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">ipopt_solve_str</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">bool_sparsity_str</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">hold_memory_str</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">derivative_test_str</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">start_near_solution_str</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">number_fixed_samples</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atoi</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">number_locations</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atoi</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">max_population</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atoi</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">mean_population</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atof</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">mean_logit_probability</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atof</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">std_logit_probability</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atof</span><span class="p">(</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">random_constraint_str</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="n">iarg</span><span class="o">++</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">random_constraint</span><span class="w">    </span><span class="o">=</span><span class="w">  </span><span class="n">random_constraint_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">quasi_fixed</span><span class="w">          </span><span class="o">=</span><span class="w">  </span><span class="n">quasi_fixed_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">trace_optimize_fixed</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">trace_optimize_fixed_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">ipopt_solve</span><span class="w">          </span><span class="o">=</span><span class="w">  </span><span class="n">ipopt_solve_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">bool_sparsity</span><span class="w">        </span><span class="o">=</span><span class="w">  </span><span class="n">bool_sparsity_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">hold_memory</span><span class="w">          </span><span class="o">=</span><span class="w">  </span><span class="n">hold_memory_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">derivative_test</span><span class="w">      </span><span class="o">=</span><span class="w">  </span><span class="n">derivative_test_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">bool</span><span class="w"> </span><span class="n">start_near_solution</span><span class="w">  </span><span class="o">=</span><span class="w">  </span><span class="n">start_near_solution_str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// hold memory setting</span>
<span class="w">   </span><span class="n">CppAD</span><span class="o">::</span><span class="n">thread_alloc</span><span class="o">::</span><span class="n">hold_memory</span><span class="p">(</span><span class="n">hold_memory</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// print the command line arugments with labels for each value</span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_arg</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">label_print</span><span class="p">(</span><span class="n">arg_name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">number_fixed_samples</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">number_locations</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">number_random</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">max_population</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">mean_population</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">std_logit_probability</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">random_constraint</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">random_constraint_str</span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">quasi_fixed</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">quasi_fixed_str</span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">trace_optimize_fixed</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">trace_optimize_fixed_str</span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">ipopt_solve</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ipopt_solve_str</span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">bool_sparsity</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">bool_sparsity_str</span><span class="w"> </span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">hold_memory</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">hold_memory_str</span><span class="w"> </span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">derivative_test</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">derivative_test_str</span><span class="w"> </span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">assert</span><span class="p">(</span><span class="w"> </span><span class="n">start_near_solution</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">start_near_solution_str</span><span class="w"> </span><span class="o">==</span><span class="s">&quot;no&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// configuration options</span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;cppad_mixed_version&quot;</span><span class="p">,</span><span class="w">    </span><span class="n">CPPAD_MIXED_VERSION</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">bool_print</span><span class="p">(</span><span class="s">&quot;ldlt_cholmod&quot;</span><span class="p">,</span><span class="w">            </span><span class="n">CPPAD_MIXED_LDLT_CHOLMOD</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">bool_print</span><span class="p">(</span><span class="s">&quot;optimize_cppad_function&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CPPAD_MIXED_OPTIMIZE_CPPAD_FUNCTION</span><span class="p">);</span><span class="w"></span>
<span class="cp"># ifdef NDEBUG</span>
<span class="w">   </span><span class="n">bool_print</span><span class="p">(</span><span class="s">&quot;ndebug_defined&quot;</span><span class="p">,</span><span class="w">          </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="cp"># else</span>
<span class="w">   </span><span class="n">bool_print</span><span class="p">(</span><span class="s">&quot;ndebug_defined&quot;</span><span class="p">,</span><span class="w">          </span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<span class="cp"># endif</span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// Get actual seed (different when random_seed is zero).</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">actual_seed</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">new_gsl_rng</span><span class="p">(</span><span class="w"> </span><span class="n">random_seed</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;actual_seed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">actual_seed</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// number of fixed and random effects</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_fixed</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n_random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_random</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// number of random effects</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_random</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">number_locations</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_population</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="nf">theta_sim</span><span class="p">(</span><span class="n">n_fixed</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_sim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_population</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_sim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_logit_probability</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_sim</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std_logit_probability</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// simulate y</span>
<span class="w">   </span><span class="n">s_vector</span><span class="w"> </span><span class="nf">y</span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">simulate</span><span class="p">(</span><span class="n">random_constraint</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">theta_sim</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="c1">// lower and upper limits</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">fix_constraint_lower</span><span class="p">,</span><span class="w"> </span><span class="n">fix_constraint_upper</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="nf">theta_lower</span><span class="p">(</span><span class="n">n_fixed</span><span class="p">),</span><span class="w"> </span><span class="n">theta_in</span><span class="p">(</span><span class="n">n_fixed</span><span class="p">),</span><span class="w"> </span><span class="n">theta_upper</span><span class="p">(</span><span class="n">n_fixed</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// theta[0] is estimate of mean_population</span>
<span class="w">   </span><span class="n">theta_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mean_population</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mean_population</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// theta[1] is estimate of mean_logit_probability</span>
<span class="w">   </span><span class="n">theta_lower</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_logit_probability</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_in</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">mean_logit_probability</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_upper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_logit_probability</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// theta[2] is estimate of std_logit_probability</span>
<span class="w">   </span><span class="n">theta_lower</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std_logit_probability</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10.</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_in</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">std_logit_probability</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">theta_upper</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std_logit_probability</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10.</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// check if we are starting at the simulation values</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">start_near_solution</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_fixed</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">theta_in</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta_sim</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="c1">// random constraints</span>
<span class="w">   </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">sparse_rc</span><span class="w"> </span><span class="n">A_pattern</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">random_constraint</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="n">A_pattern</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">A_pattern</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="n">d_sparse_rcv</span><span class="w"> </span><span class="n">A_rcv</span><span class="p">(</span><span class="w"> </span><span class="n">A_pattern</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">A_rcv</span><span class="p">.</span><span class="n">nc</span><span class="p">();</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">A_rcv</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="c1">// initialize random effects to start optimization at</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="nf">u_in</span><span class="p">(</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">u_in</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// create derived object</span>
<span class="w">   </span><span class="n">mixed_derived</span><span class="w"> </span><span class="nf">mixed_object</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">quasi_fixed</span><span class="p">,</span><span class="w"> </span><span class="n">bool_sparsity</span><span class="p">,</span><span class="w"> </span><span class="n">A_rcv</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">theta_in</span><span class="p">,</span><span class="w"> </span><span class="n">u_in</span><span class="w"></span>
<span class="w">   </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// start timing of initialize</span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="kr">thread</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">thread_alloc</span><span class="o">::</span><span class="n">thread_num</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">start_bytes</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">thread_alloc</span><span class="o">::</span><span class="n">inuse</span><span class="p">(</span><span class="kr">thread</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">start_seconds</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="n">mixed_object</span><span class="p">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">theta_in</span><span class="p">,</span><span class="w"> </span><span class="n">u_in</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="kt">size_t</span><span class="w"> </span><span class="n">end_bytes</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">thread_alloc</span><span class="o">::</span><span class="n">inuse</span><span class="p">(</span><span class="kr">thread</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// print amoumt of memory added to mixed_object during initialize</span>
<span class="w">   </span><span class="c1">// (use commans to separate every three digits).</span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">initialize_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size_t2string</span><span class="p">(</span><span class="n">end_bytes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_bytes</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;initialize_bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">initialize_bytes</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;initialize_seconds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_seconds</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// ipopt options for optimizing the random effects</span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">random_ipopt_options</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;Integer print_level               0</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;String  sb                        yes</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;String  derivative_test           none</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;Numeric tol                       1e-9</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">   </span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ipopt_solve</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">random_ipopt_options</span><span class="w"> </span><span class="o">+=</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;String evaluation_method         ipopt_solve</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// ipopt options for optimizing the fixd effects</span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">fixed_ipopt_options</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;String  sb                        yes</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;Numeric tol                       1e-9</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;Integer max_iter                  40</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">   </span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">trace_optimize_fixed</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">fixed_ipopt_options</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;Integer print_level         5</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="n">fixed_ipopt_options</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;Integer print_level         0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">derivative_test</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">fixed_ipopt_options</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;String derivative_test      first-order</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="n">fixed_ipopt_options</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;String derivative_test      none</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">inf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="nf">u_lower</span><span class="p">(</span><span class="n">n_random</span><span class="p">),</span><span class="w"> </span><span class="n">u_upper</span><span class="p">(</span><span class="n">n_random</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_random</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="n">u_lower</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">inf</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">u_upper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="n">inf</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// optimize fixed effects</span>
<span class="w">   </span><span class="n">start_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">trace_optimize_fixed</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">theta_scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theta_in</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">fixed_solution</span><span class="w"> </span><span class="n">solution</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mixed_object</span><span class="p">.</span><span class="n">optimize_fixed</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">fixed_ipopt_options</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">random_ipopt_options</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_lower</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_upper</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">fix_constraint_lower</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">fix_constraint_upper</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_scale</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_in</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">u_lower</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">u_upper</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">u_in</span><span class="w"></span>
<span class="w">   </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">trace_optimize_fixed</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;optimize_fixed_seconds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_seconds</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// estimate of fixed effects</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">theta_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solution</span><span class="p">.</span><span class="n">fixed_opt</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// estimate of random effects</span>
<span class="w">   </span><span class="n">start_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">u_out</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">mixed_object</span><span class="p">.</span><span class="n">optimize_random</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">random_ipopt_options</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_out</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">u_lower</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">u_upper</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">u_in</span><span class="w"></span>
<span class="w">   </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;optimize_random_seconds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_seconds</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// information matrix</span>
<span class="w">   </span><span class="n">start_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">d_sparse_rcv</span><span class="w"> </span><span class="n">hes_fixed_obj_rcv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mixed_object</span><span class="p">.</span><span class="n">hes_fixed_obj</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">solution</span><span class="p">.</span><span class="n">fixed_opt</span><span class="p">,</span><span class="w"> </span><span class="n">u_out</span><span class="w"></span>
<span class="w">   </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;information_mat_seconds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_seconds</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// sample approximate posteroior for fixed effects</span>
<span class="w">   </span><span class="n">start_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="w"> </span><span class="n">number_fixed_samples</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_fixed</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">mixed_object</span><span class="p">.</span><span class="n">sample_fixed</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">sample</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">hes_fixed_obj_rcv</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">solution</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_lower</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">theta_upper</span><span class="w"></span>
<span class="w">   </span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">elapsed_seconds</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;sample_fixed_seconds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end_seconds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_seconds</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="n">end_bytes</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">CppAD</span><span class="o">::</span><span class="n">thread_alloc</span><span class="o">::</span><span class="n">inuse</span><span class="p">(</span><span class="kr">thread</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">string</span><span class="w"> </span><span class="n">final_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size_t2string</span><span class="p">(</span><span class="n">end_bytes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_bytes</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;final_bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">final_bytes</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// sum of random effects</span>
<span class="w">   </span><span class="kt">double</span><span class="w"> </span><span class="n">sum_random_effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_random</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">sum_random_effects</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">u_out</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">random_constraint</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">ok</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fabs</span><span class="p">(</span><span class="w"> </span><span class="n">sum_random_effects</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1e-8</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;sum_random_effects&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sum_random_effects</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// sample_std</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="nf">sample_std</span><span class="p">(</span><span class="n">n_fixed</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_fixed</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">sample_std</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">number_fixed_samples</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_fixed</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">diff</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n_fixed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theta_out</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">         </span><span class="n">sample_std</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diff</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">// estimate_ratio</span>
<span class="w">   </span><span class="n">d_vector</span><span class="w"> </span><span class="n">estimate_ratio</span><span class="p">(</span><span class="n">n_fixed</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n_fixed</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w">  </span><span class="n">sample_std</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_std</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="kt">double</span><span class="p">(</span><span class="n">number_fixed_samples</span><span class="p">));</span><span class="w"></span>
<span class="w">      </span><span class="c1">// check if results results are reasonable</span>
<span class="w">      </span><span class="n">estimate_ratio</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">theta_out</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">theta_sim</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sample_std</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="n">ok</span><span class="w">  </span><span class="o">&amp;=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fabs</span><span class="p">(</span><span class="n">estimate_ratio</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">// estimates</span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;mean_population_estimate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">theta_out</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;mean_logit_probability_estimate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">theta_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;std_logit_probability_estimate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">theta_out</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="c1">// simulation sample standard deviations</span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;mean_population_std&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sample_std</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;mean_logit_probability_std&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sample_std</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;std_logit_probability_std&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sample_std</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="c1">// ratios, error conditon is ratio &gt;= 5.0</span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;mean_population_ratio&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">estimate_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;mean_logit_probability_ratio&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">estimate_ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;std_logit_probability_ratio&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">estimate_ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;capture_xam_ok&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="n">label_print</span><span class="p">(</span><span class="s">&quot;capture_xam_ok&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">//</span>
<span class="w">   </span><span class="c1">// make sure CppAD::thread_alloc is no longer holding memory</span>
<span class="w">   </span><span class="n">CppAD</span><span class="o">::</span><span class="n">thread_alloc</span><span class="o">::</span><span class="n">hold_memory</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">// free memory allocated by new_gsl_rng</span>
<span class="w">   </span><span class="n">CppAD</span><span class="o">::</span><span class="n">mixed</span><span class="o">::</span><span class="n">free_gsl_rng</span><span class="p">();</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="capture_xam.sh.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">capture_xam.sh</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="ar1_xam.sh.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">ar1_xam.sh</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">capture_xam.cpp</a><ul>
<li><a class="reference internal" href="#a-capture-example-and-speed-test">A Capture Example and Speed Test</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#command-arguments">Command Arguments</a><ul>
<li><a class="reference internal" href="#random-seed">random_seed</a></li>
<li><a class="reference internal" href="#number-random">number_random</a></li>
<li><a class="reference internal" href="#quasi-fixed">quasi_fixed</a></li>
<li><a class="reference internal" href="#trace-optimize-fixed">trace_optimize_fixed</a></li>
<li><a class="reference internal" href="#ipopt-solve">ipopt_solve</a></li>
<li><a class="reference internal" href="#bool-sparsity">bool_sparsity</a></li>
<li><a class="reference internal" href="#hold-memory">hold_memory</a></li>
<li><a class="reference internal" href="#derivative-test">derivative_test</a></li>
<li><a class="reference internal" href="#start-near-solution">start_near_solution</a></li>
<li><a class="reference internal" href="#number-fixed-samples">number_fixed_samples</a></li>
<li><a class="reference internal" href="#number-locations">number_locations</a></li>
<li><a class="reference internal" href="#max-population">max_population</a></li>
<li><a class="reference internal" href="#mean-population">mean_population</a></li>
<li><a class="reference internal" href="#mean-logit-probability">mean_logit_probability</a></li>
<li><a class="reference internal" href="#std-logit-probability">std_logit_probability</a></li>
<li><a class="reference internal" href="#random-constraint">random_constraint</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output">Output</a><ul>
<li><a class="reference internal" href="#cppad-mixed-version">cppad_mixed_version</a></li>
<li><a class="reference internal" href="#ldlt-cholmod">ldlt_cholmod</a></li>
<li><a class="reference internal" href="#optimize-cppad-function">optimize_cppad_function</a></li>
<li><a class="reference internal" href="#ndebug-defined">ndebug_defined</a></li>
<li><a class="reference internal" href="#actual-seed">actual_seed</a></li>
<li><a class="reference internal" href="#initialize-bytes">initialize_bytes</a></li>
<li><a class="reference internal" href="#initialize-seconds">initialize_seconds</a></li>
<li><a class="reference internal" href="#optimize-fixed-seconds">optimize_fixed_seconds</a></li>
<li><a class="reference internal" href="#optimize-random-seconds">optimize_random_seconds</a></li>
<li><a class="reference internal" href="#information-mat-seconds">information_mat_seconds</a></li>
<li><a class="reference internal" href="#sample-fixed-seconds">sample_fixed_seconds</a></li>
<li><a class="reference internal" href="#final-bytes">final_bytes</a></li>
<li><a class="reference internal" href="#sum-random-effects">sum_random_effects</a></li>
<li><a class="reference internal" href="#mean-population-estimate">mean_population_estimate</a></li>
<li><a class="reference internal" href="#mean-logit-probability-estimate">mean_logit_probability_estimate</a></li>
<li><a class="reference internal" href="#std-logit-probability-estimate">std_logit_probability_estimate</a></li>
<li><a class="reference internal" href="#mean-population-std">mean_population_std</a></li>
<li><a class="reference internal" href="#mean-logit-probability-std">mean_logit_probability_std</a></li>
<li><a class="reference internal" href="#std-logit-probability-std">std_logit_probability_std</a></li>
<li><a class="reference internal" href="#mean-population-ratio">mean_population_ratio</a></li>
<li><a class="reference internal" href="#mean-logit-probability-ratio">mean_logit_probability_ratio</a></li>
<li><a class="reference internal" href="#std-probability-ratio">std_probability_ratio</a></li>
<li><a class="reference internal" href="#capture-xam-ok">capture_xam_ok</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#notation">Notation</a></li>
<li><a class="reference internal" href="#p-y-it-n-i-q-t">p(y_it|N_i,q_t)</a></li>
<li><a class="reference internal" href="#p-n-i-theta">p(N_i|theta)</a></li>
<li><a class="reference internal" href="#q-t-theta-u">q_t(theta,u)</a></li>
<li><a class="reference internal" href="#m-i">M_i</a></li>
<li><a class="reference internal" href="#p-y-i-theta-u">p(y_i|theta,u)</a></li>
<li><a class="reference internal" href="#p-y-theta-u">p(y|theta,u)</a></li>
<li><a class="reference internal" href="#p-u-theta">p(u|theta)</a></li>
<li><a class="reference internal" href="#p-theta">p(theta)</a></li>
<li><a class="reference internal" href="#p-z-theta">p(z|theta)</a></li>
<li><a class="reference internal" href="#c-theta">c(theta)</a></li>
<li><a class="reference internal" href="#source-code">Source Code</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>